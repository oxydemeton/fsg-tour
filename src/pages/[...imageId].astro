---
import { getCollection } from "astro:content";
import { Image } from 'astro:assets';
import Layout from '../layouts/Layout.astro';

export async function getStaticPaths() {
    const rooms = await getCollection('room2')
    
    return rooms.flatMap((room)=>{
        return room.data.bilder.map((img, i)=>{
            return {
                params: {imageId: `${room.id}/${img.name}`},
                props: {room, imageId: i}
            }
        })
    });
};

/*export const getStaticPaths = ( async () => {
    const rooms = await getCollection("rooms")
    return rooms.map();
}) satisfies GetStaticPaths;*/

const {room, imageId} = Astro.props
const data = room.data
const baseUrl = import.meta.env.BASE_URL
const local = Astro.props.room.data.bilder[imageId]
const prevImageUrl = `${baseUrl}/${data.slug}/${data.bilder.at(imageId-1)?.name}`
const nextImageUrl = `${baseUrl}/${data.slug}/${data.bilder.at((imageId+1)%data.bilder.length)?.name}`
const transitImageUrl = `${baseUrl}/${local.verbindung}`
---

<Layout title={`FSG-Tour - ${room.data.name}`}>
    <h1>{room.data.name}</h1>
    <h2>Richtung: {local.name}</h2>
    <div class="relative">
        <Image src={local.image} alt={local.name} width={1920} transition:animate="fade" class="-z-10"/>
        <a href={prevImageUrl} class="absolute top-[50%] left-4 -rotate-90" data-astro-prefetch="viewport">
            <svg viewBox="-2 -2 12 12" class="w-8 h-8">
                <line x1="0" y1="8" x2="4" y2="0" class="stroke-black stroke-2" stroke-linecap="round"/>
                <line x1="4" y1="0" x2="8" y2="8" class="stroke-black stroke-2" stroke-linecap="round">
            </svg>
        </a>
        {(typeof local.verbindung === "string") ? 
            <a href={transitImageUrl} class="absolute top-[50%] right-[50%]" data-astro-prefetch="viewport">
                <svg viewBox="-2 -2 12 12" class="w-8 h-8">
                    <line x1="0" y1="8" x2="4" y2="0" class="stroke-black stroke-2" stroke-linecap="round"/>
                    <line x1="4" y1="0" x2="8" y2="8" class="stroke-black stroke-2" stroke-linecap="round"/>
                </svg>
            </a>
            : undefined}
        <a href={nextImageUrl} class="absolute top-[50%] right-4 rotate-90" data-astro-prefetch="viewport">
            <svg viewBox="-2 -2 12 12" class="w-8 h-8">
                <line x1="0" y1="8" x2="4" y2="0" class="stroke-black stroke-2" stroke-linecap="round"/>
                <line x1="4" y1="0" x2="8" y2="8" class="stroke-black stroke-2" stroke-linecap="round"/>
            </svg>
        </a>
    </div>
</Layout>
<style>
    a {
        @apply text-white/80 font-black text-3xl;
    }
</style>